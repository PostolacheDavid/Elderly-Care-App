#:kivy 2.3.0

<ApproveItem@MDBoxLayout>:
    full_name: ""
    email: ""
    doctor_id: 0
    image_texture: None
    orientation: "vertical"
    spacing: dp(10)
    padding: dp(10)
    size_hint_y: None
    height: dp(250)
    md_bg_color: 0.95, 0.95, 1, 1
    photo_data: None

    Image:
        size_hint: None, None
        size: dp(150), dp(150)
        pos_hint: {"center_x": 0.5}
        texture: root.image_texture
        allow_stretch: True
        keep_ratio: True
        on_touch_down:
            if self.collide_point(*args[1].pos): app.root.get_screen("main").preview_image(root.photo_data)


    MDLabel:
        text: "Name: " + root.full_name
        theme_text_color: "Primary"
        halign: "center"

    MDLabel:
        text: "Email: " + root.email
        theme_text_color: "Secondary"
        halign: "center"

    MDRaisedButton:
        text: "Approve"
        size_hint: None, None
        size: dp(120), dp(40)
        pos_hint: {"center_x": 0.5}
        on_release:
            app.root.get_screen("main").approve_account(root.doctor_id)

ScreenManager:
    LoginScreen:
    MainScreen:
    DoctorRegisterScreen:

<LoginScreen>:
    name: "login"
    md_bg_color: 0.827, 0.827, 0.827, 1
    MDBoxLayout:
        orientation: "vertical"
        padding: "20dp"
        spacing: "30dp"
        pos_hint: {"center_x": 0.5, "center_y": 0.4}
        size_hint: (0.8, 0.6)

        MDLabel:
            text: "Elderly Care App"
            font_style: "H3"
            font_name: "assets/fonts/DancingScript-VariableFont_wght.ttf"
            halign: "center"
            padding: [0, 0, 0, 300]
            theme_text_color: "Custom"
            text_color: 120/255, 190/255, 220/255

        MDBoxLayout:
            orientation: "horizontal"
            spacing: "20dp"
            size_hint_x: 0.8
            pos_hint: {"center_x":0.5}

            MDIcon:
                icon: "assets/icons/account.png"
                size_hint_x: None
                width: "40dp"
                pos_hint: {"center_y":1.6}

            MDBoxLayout:
                orientation: "vertical"
                size_hint_x: 0.8
                pos_hint: {"center_x": 0.5}
                spacing: "0dp"

                MDLabel:
                    id: helper_label
                    text: "Enter username"
                    theme_text_color: "Hint"
                    font_style: "Caption"
                    size_hint_y: None
                    height: self.texture_size[1]

                MDTextField:
                    id: username
                    mode: "fill"

        Widget:
            size_hint_y: None
            height: "20dp"

        MDBoxLayout:
            orientation: "horizontal"
            spacing: "20dp"
            size_hint_x: 0.8
            pos_hint: {"center_x":0.5}

            MDIcon:
                icon: "assets/icons/lock.png"
                size_hint_x: None
                width: "40dp"
                pos_hint: {"center_y":1.6}

            MDBoxLayout:
                orientation: "vertical"
                size_hint_x: 0.8
                pos_hint: {"center_x": 0.5}
                spacing: "0dp"

                MDLabel:
                    id: helper_label_pass
                    text: "Enter password"
                    theme_text_color: "Hint"
                    font_style: "Caption"
                    size_hint_y: None
                    height: self.texture_size[1]

                MDTextField:
                    id: password
                    password: True
                    hint_text: ""
                    mode: "fill"

        MDLabel:
            id: login_status
            text: ""
            theme_text_color: "Custom"
            text_color: 1, 0, 0, 1
            halign: "center"
        MDRaisedButton:
            text: "Login"
            pos_hint: {"center_x": 0.5}
            size_hint_x: 0.8
            on_release: root.login()
        MDLabel:
            text: "[ref=link]Forgot Password?[/ref]"
            markup: True
            theme_text_color: "Custom"
            text_color: 120/255, 190/255, 220/255
            halign: "center"
            on_ref_press: root.forgot_password()
        MDLabel:
            text: "[ref=link]Don't have an account?[/ref]"
            markup: True
            theme_text_color: "Custom"
            text_color: 120/255, 190/255, 220/255
            halign: "center"
            on_ref_press: app.root.current = "doctor_register"

<DoctorRegisterScreen>:
    name: "doctor_register"
    md_bg_color: 0.827, 0.827, 0.827, 1

    MDFlatButton:
        text: "<- Back"
        halign: "left"
        on_release:
            app.root.current = "login"

    MDBoxLayout:
        orientation: "vertical"
        spacing: "20dp"
        size_hint_x: 0.8
        size_hint_y: None
        height: self.minimum_height
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

        MDLabel:
            text: "Create Doctor Account"
            font_style: "H5"
            halign: "center"
            theme_text_color: "Custom"
            text_color: 120/255, 190/255, 220/255
            size_hint_y: None
            height: self.texture_size[1]

        MDBoxLayout:
            orientation: "horizontal"
            spacing: "20dp"
            size_hint_x: 1
            pos_hint: {"center_x": 0.5}
            size_hint_y: None
            height: "60dp"

            MDLabel:
                text: "Full Name"
                size_hint_x: 0.4
                halign: "right"
                valign: "middle"
                theme_text_color: "Primary"
                size_hint_y: None
                height: self.texture_size[1]
                pos_hint: {"center_y": 0.4}

            MDTextField:
                id: full_name
                mode: "fill"
                size_hint_x: 0.6
        
        MDBoxLayout:
            orientation: "horizontal"
            spacing: "20dp"
            size_hint_x: 1
            pos_hint: {"center_x": 0.5}
            size_hint_y: None
            height: "60dp"

            MDLabel:
                text: "E-Mail"
                size_hint_x: 0.4
                halign: "right"
                valign: "middle"
                theme_text_color: "Primary"
                size_hint_y: None
                height: self.texture_size[1]
                pos_hint: {"center_y": 0.4}

            MDTextField:
                id: email
                mode: "fill"
                size_hint_x: 0.6

        MDBoxLayout:
            orientation: "horizontal"
            spacing: "20dp"
            size_hint_x: 1
            pos_hint: {"center_x": 0.5}
            size_hint_y: None
            height: "60dp"

            MDLabel:
                text: "Password"
                size_hint_x: 0.4
                halign: "right"
                valign: "middle"
                theme_text_color: "Primary"
                size_hint_y: None
                height: self.texture_size[1]
                pos_hint: {"center_y": 0.4}

            MDTextField:
                id: password
                password: True
                mode: "fill"
                size_hint_x: 0.6

        MDBoxLayout:
            orientation: "horizontal"
            spacing: "20dp"
            size_hint_x: 1
            pos_hint: {"center_x": 0.5}
            size_hint_y: None
            height: "60dp"

            MDLabel:
                text: "Type Password Again"
                size_hint_x: 0.4
                halign: "right"
                valign: "middle"
                theme_text_color: "Primary"
                size_hint_y: None
                height: self.texture_size[1]
                pos_hint: {"center_y": 0.4}

            MDTextField:
                id: rewrite_password
                password: True
                mode: "fill"
                size_hint_x: 0.6
        
        MDBoxLayout:
            orientation: "horizontal"
            spacing: "20dp"
            size_hint_x: 1
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            size_hint_y: None
            height: "60dp"

            Widget:
                size_hint_y: None
                width: "0dp"

            MDLabel:
                text: "Degree"
                font_size: "18sp"
                size_hint_y: None
                size_hint_x: None
                halign: "right"
                valign: "middle"
                theme_text_color: "Primary"
                size_hint_y: None
                height: self.texture_size[1]
                pos_hint: {"center_y": 0.4}

            Widget:
                size_hint_y: None
                width: "0dp"

            MDRaisedButton:
                text: "Upload Photo"
                pos_hint: {"center_x": 0.5}
                on_release: root.open_file_chooser()
            
        MDRaisedButton:
            text: "Create Account"
            pos_hint: {"center_x": 0.5}
            size_hint_x: 0.8
            on_release: root.submit_request()
                


<MainScreen>:
    name: "main"

    MDNavigationLayout:

        ScreenManager:
            id: screen_manager

            Screen:

                MDBoxLayout:
                    orientation: 'vertical'

                    MDTopAppBar:
                        md_bg_color: 0.827, 0.827, 0.827, 1

                        # Left custom icon
                        AnchorLayout:
                            anchor_x: 'left'
                            anchor_y: 'center'

                            MDIconButton:
                                icon: "assets/icons/menu.png"
                                icon_size: "48sp"
                                on_release: nav_drawer.set_state("toggle")

                        # Right custom icon
                        AnchorLayout:
                            anchor_x: 'right'
                            anchor_y: 'bottom'

                            MDIconButton:
                                icon: "assets/icons/magnify.png"
                                icon_size: "36sp"
                                theme_icon_color: "Custom"
                                icon_color: 1, 1, 1, 1
                                #on_release: app.on_magnify_click()

                    MDBottomNavigation:
                        panel_color: 0.827, 0.827, 0.827, 1
                        MDBottomNavigationItem: #Butonul pentru account
                            name:"Account Screen"
                            text:"Account"
                            icon:"assets/icons/account.png"
                            MDScreen: #Ecran pentru atunci cand apesi butonul
                                MDBoxLayout:
                                    pos_hint:{'center_x':0.5, 'center_y':0.5}
                                    orientation:'vertical'
                                    size_hint_y: 0.4
                                    size_hint_x: 0.4
                                    spacing: "40dp"
                                    MDLabel:
                                        text: "Welcome to the Account Screen!"
                                        halign: "center"
                        MDBottomNavigationItem:
                            name:"Health Screen"
                            text:"Health"
                            icon:"assets/icons/health.png"
                            MDScreen: #Ecran pentru atunci cand apesi butonul
                                ScreenManager:
                                    id: health_manager

                                    Screen:
                                        name: "doctor_health"
                                        ScrollView:
                                            bar_width:0
                                            MDBoxLayout:
                                                orientation:'vertical'
                                                adaptive_height:True
                                                spacing:'20dp'
                                                padding:'20dp'
                                                MDLabel:
                                                    text:"Doctor's Health Dashboard"
                                                    font_style:"Subtitle2"
                                                MDGridLayout:
                                                    cols:2
                                                    adaptive_height:True
                                                    size_hint_y: None
                                                    height: self.minimum_height 
                                                    spacing:'15dp'
                                                    GridCard:
                                                        source:"assets/icons/pill.png"
                                                        text:"Add Pacients Medicine"
                                                        on_release: root.add_medication_screen()
                                                    GridCard:
                                                        source:"assets/icons/pill.png"
                                                        text:"See Pacients Medicine"
                                                        on_release: root.open_view_medications_doctor_screen()
                                                    GridCard:
                                                        source:"assets/icons/pacients.png"
                                                        text:"Add Pacients"
                                                        on_release: root.create_elder_screen()
                                                    GridCard:
                                                        source:"assets/icons/caregiver.png"
                                                        text:"Add Caregivers"
                                                        on_release: root.create_caregiver_screen()
                                                    GridCard:
                                                        source:"assets/icons/nurse.png"
                                                        text:"Medical Controls"
                                                        on_release: root.open_doctor_controls_screen()

                                    
                                    
                                    Screen:
                                        name: "view_controls_doctor"

                                        ScrollView:
                                            do_scroll_x: False
                                            do_scroll_y: True

                                            MDBoxLayout:
                                                orientation: "vertical"
                                                size_hint_y: None
                                                height: self.minimum_height
                                                padding: dp(10)
                                                spacing: dp(10)

                                                # Elder selector and form fields
                                                MDTextField:
                                                    id: doctor_controls_elder_dropdown
                                                    hint_text: "Selectează pacientul"
                                                    readonly: True
                                                    size_hint_y: None
                                                    height: dp(56)
                                                    on_focus:
                                                        if self.focus: root.open_elder_menu_for_controls()

                                                MDTextField:
                                                    id: ctrl_name
                                                    hint_text: "Control Name"
                                                    mode: "rectangle"
                                                    size_hint_y: None
                                                    height: dp(48)

                                                MDTextField:
                                                    id: ctrl_goal
                                                    hint_text: "Goal"
                                                    mode: "rectangle"
                                                    size_hint_y: None
                                                    height: dp(48)

                                                MDTextField:
                                                    id: ctrl_details
                                                    hint_text: "Details"
                                                    mode: "rectangle"
                                                    multiline: True
                                                    size_hint_y: None
                                                    height: dp(80)

                                                MDTextField:
                                                    id: ctrl_datetime
                                                    hint_text: "YYYY-MM-DD HH:MM"
                                                    mode: "rectangle"
                                                    size_hint_y: None
                                                    height: dp(48)

                                                ScrollView:
                                                    do_scroll_x: False
                                                    do_scroll_y: True
                                                    size_hint_y: None
                                                    height: dp(200)   # or whatever fixed height you need

                                                    MDBoxLayout:
                                                        id: controls_list_doctor
                                                        orientation: "vertical"
                                                        adaptive_height: True     # ← important!
                                                        spacing: dp(10)

                                                # Buttons immediately below the list
                                                MDRaisedButton:
                                                    text: "Save Control"
                                                    #size_hint_y: None
                                                    #height: dp(48)
                                                    on_release:
                                                        app.root.get_screen("main").submit_control(
                                                        root.selected_elder_for_control["id"],
                                                        root.user_id,
                                                        ctrl_name.text.strip(),
                                                        ctrl_goal.text.strip(),
                                                        ctrl_details.text.strip(),
                                                        ctrl_datetime.text.strip()
                                                        )

                                                MDRaisedButton:
                                                    text: "Back"
                                                    #size_hint_y: None
                                                    #height: dp(48)
                                                    on_release: root.update_ui()


                                    Screen:
                                        name: "create_elder"

                                        ScrollView:
                                            MDBoxLayout:
                                                orientation: "vertical"
                                                spacing: "20dp"
                                                padding: "20dp"
                                                size_hint_y: None
                                                height: self.minimum_height

                                                MDLabel:
                                                    text: "Create Elder Account"
                                                    halign: "center"
                                                    font_style: "H5"
                                                    theme_text_color: "Custom"
                                                    text_color: 120/255, 190/255, 220/255

                                                MDTextField:
                                                    id: elder_full_name
                                                    hint_text: "Full Name"
                                                    mode: "fill"

                                                MDTextField:
                                                    id: elder_email
                                                    hint_text: "Email"
                                                    mode: "fill"

                                                MDTextField:
                                                    id: elder_password
                                                    hint_text: "Password"
                                                    password: True
                                                    mode: "fill"

                                                MDTextField:
                                                    id: elder_confirm_password
                                                    hint_text: "Confirm Password"
                                                    password: True
                                                    mode: "fill"

                                                MDRaisedButton:
                                                    text: "Create Elder"
                                                    pos_hint: {"center_x": 0.5}
                                                    on_release: root.submit_elder()
                                                MDRaisedButton:
                                                    text: "Back"
                                                    pos_hint: {"center_x": 0.5}
                                                    on_release: root.update_ui()

                                    Screen:
                                        name: "create_caregiver"

                                        ScrollView:
                                            MDBoxLayout:
                                                orientation: "vertical"
                                                spacing: "20dp"
                                                padding: "20dp"
                                                size_hint_y: None
                                                height: self.minimum_height

                                                MDLabel:
                                                    text: "Create Caregiver Account"
                                                    halign: "center"
                                                    font_style: "H5"
                                                    theme_text_color: "Custom"
                                                    text_color: 120/255, 190/255, 220/255

                                                MDTextField:
                                                    id: caregiver_full_name
                                                    hint_text: "Full Name"
                                                    mode: "fill"

                                                MDTextField:
                                                    id: caregiver_email
                                                    hint_text: "Email"
                                                    mode: "fill"

                                                MDTextField:
                                                    id: caregiver_password
                                                    hint_text: "Password"
                                                    password: True
                                                    mode: "fill"

                                                MDTextField:
                                                    id: caregiver_confirm_password
                                                    hint_text: "Confirm Password"
                                                    password: True
                                                    mode: "fill"

                                                MDTextField:
                                                    id: elder_field
                                                    hint_text: "Select Elder"
                                                    text: ""                # start with no text so hint_text is visible
                                                    readonly: True          # prevent manual typing (selection only)
                                                    icon_right: "chevron-down"   # optional: drop-down icon on the right
                                                    icon_right_color: app.theme_cls.primary_color
                                                    pos_hint: {"center_x": 0.5, "top": 0.9}   # adjust positioning as needed
                                                    size_hint_x: 0.8        # adjust width as needed
                                                    on_focus: if self.focus: root.open_elder_menu()

                                                MDRaisedButton:
                                                    text: "Create Caregiver"
                                                    pos_hint: {"center_x": 0.5}
                                                    on_release: root.submit_caregiver()
                                                MDRaisedButton:
                                                    text: "Back"
                                                    pos_hint: {"center_x": 0.5}
                                                    on_release: root.update_ui()

                                    MDScreen:
                                        name: "view_medications"
                                        # remove the old on_pre_enter line; we'll call view_medications_screen() manually

                                        MDBoxLayout:
                                            orientation: "vertical"

                                            MDTopAppBar:
                                                title: "My Medications"
                                                left_action_items: [["arrow-left", lambda x: root.update_ui()]]

                                            ScrollView:
                                                MDBoxLayout:
                                                    id: medications_list
                                                    orientation: "vertical"
                                                    size_hint_y: None
                                                    height: self.minimum_height
                                                    padding: dp(10)
                                                    spacing: dp(10)

                                            MDRaisedButton:
                                                text: "Back"
                                                pos_hint: {"center_x": 0.5}
                                                on_release: root.update_ui()



                                    Screen:
                                        name: "add_medication"

                                        ScrollView:
                                            do_scroll_x: False
                                            do_scroll_y: True

                                            MDBoxLayout:
                                                orientation: "vertical"
                                                padding: dp(10)
                                                spacing: dp(10)
                                                size_hint_y: None
                                                height: self.minimum_height

                                                MDTextField:
                                                    id: med_name
                                                    hint_text: "Alege medicament"
                                                    readonly: True
                                                    on_focus: if self.focus: root.open_medication_dialog()

                                                MDTextField:
                                                    id: med_forma
                                                    hint_text: "Formă farmaceutică"
                                                    readonly: True

                                                MDTextField:
                                                    id: med_conc
                                                    hint_text: "Concentrație"
                                                    readonly: True

                                                MDTextField:
                                                    id: med_frequency
                                                    hint_text: "Frecvență administrare (ex: 1 dată/zi)"
                                                    mode: "rectangle"

                                                MDTextField:
                                                    id: med_elder
                                                    hint_text: "Selectează pacientul"
                                                    mode: "rectangle"
                                                    readonly: True
                                                    on_focus: if self.focus: root.open_elder_menu_med()

                                                MDTextField:
                                                    id: med_notes
                                                    hint_text: "Observații"
                                                    mode: "rectangle"
                                                    multiline: True

                                                MDRaisedButton:
                                                    text: "Adaugă"
                                                    on_release: root.submit_medication()

                                                MDRaisedButton:
                                                    text: "Înapoi"
                                                    size_hint_y: None
                                                    height: dp(48)
                                                    on_release: root.update_ui()


                                    Screen:
                                        name: "view_medications_doctor"

                                        ScrollView:
                                            do_scroll_x: False
                                            do_scroll_y: True

                                            MDBoxLayout:
                                                orientation: "vertical"
                                                padding: dp(10)
                                                spacing: dp(10)
                                                size_hint_y: None
                                                height: self.minimum_height

                                                MDTextField:
                                                    id: doctor_elder_dropdown
                                                    hint_text: "Selectează pacientul"
                                                    readonly: True
                                                    size_hint_y: None
                                                    height: dp(56)
                                                    on_focus:
                                                        if self.focus: root.open_elder_menu_for_doctor_view()

                                                # Your meds list container
                                                MDBoxLayout:
                                                    id: doctor_meds_list
                                                    orientation: "vertical"
                                                    size_hint_y: None
                                                    height: self.minimum_height
                                                    spacing: dp(10)

                                                MDRaisedButton:
                                                    text: "Înapoi"
                                                    size_hint_y: None
                                                    height: dp(48)
                                                    on_release: root.update_ui()



                                    Screen:
                                        name: "elder_health"
                                        ScrollView:
                                            bar_width:0
                                            MDBoxLayout:
                                                orientation:'vertical'
                                                adaptive_height:True
                                                spacing:'20dp'
                                                padding:'20dp'
                                                MDLabel:
                                                    text:"Elder's Health Dashboard"
                                                    font_style:"Subtitle2"
                                                MDGridLayout:
                                                    cols:2
                                                    adaptive_height:True
                                                    size_hint_y: None
                                                    height: self.minimum_height 
                                                    spacing:'15dp'
                                                    GridCard:
                                                        source:"assets/icons/pill.png"
                                                        text:"Medicine"
                                                        on_release: root.view_medications_screen()
                                                    GridCard:
                                                        source:"assets/icons/nurse.png"
                                                        text:"Appointments"
                                                        on_release: root.view_controls_for_elder()
                                                    GridCard:
                                                        source:"assets/icons/medical_data.png"
                                                        text:"Medical Data"
                                                    GridCard:
                                                        source:"assets/icons/fitness.png"
                                                        text:"Fitness"
                                                    #GridCard:
                                                        #source:"assets/icons/notification.png"
                                                        #text:"Notifications"
                                                    #GridCard:
                                                        #source:"assets/icons/chat.png"
                                                        #text:"Chat"
                                    
                                    MDScreen:
                                        name: "view_controls_elder"
                                        MDBoxLayout:
                                            orientation: "vertical"
                                            padding: dp(10)
                                            spacing: dp(10)

                                            MDLabel:
                                                text: "Controale Medicale"
                                                font_style: "H6"
                                                size_hint_y: None
                                                height: dp(32)
                                                halign: "center"

                                            ScrollView:
                                                MDBoxLayout:
                                                    id: elder_controls_list
                                                    orientation: "vertical"
                                                    size_hint_y: None
                                                    height: self.minimum_height
                                                    spacing: dp(10)

                                            MDRaisedButton:
                                                text: "Înapoi"
                                                size_hint_y: None
                                                height: dp(48)
                                                on_release: root.update_ui()

                                    Screen:
                                        name: "caregiver_health"
                                        ScrollView:
                                            bar_width:0
                                            MDBoxLayout:
                                                orientation:'vertical'
                                                adaptive_height:True
                                                spacing:'20dp'
                                                padding:'20dp'
                                                MDLabel:
                                                    text:"Elder's Health Dashboard"
                                                    font_style:"Subtitle2"
                                                MDGridLayout:
                                                    cols:2
                                                    adaptive_height:True
                                                    size_hint_y: None
                                                    height: self.minimum_height 
                                                    spacing:'15dp'
                                                    GridCard:
                                                        source:"assets/icons/pill.png"
                                                        text:"Medicine"
                                                        on_release: root.load_elder_medications_for_caregiver()
                                                    GridCard:
                                                        source:"assets/icons/nurse.png"
                                                        text:"Medical controls"
                                                        on_release: root.view_controls_for_caregiver()

                                    MDScreen:
                                        name: "view_medications_care"

                                        MDBoxLayout:
                                            orientation: "vertical"

                                            ScrollView:
                                                MDBoxLayout:
                                                    id: medications_list
                                                    orientation: "vertical"
                                                    size_hint_y: None
                                                    height: self.minimum_height
                                                    padding: dp(10)
                                                    spacing: dp(10)
                                                
                                            MDRaisedButton:
                                                text: "Back"
                                                pos_hint: {"center_x": 0.5}
                                                on_release: root.update_ui()
                                                    
                                    Screen:
                                        name: "admin"
                                        ScrollView:
                                            bar_width:0
                                            MDBoxLayout:
                                                orientation:'vertical'
                                                adaptive_height:True
                                                spacing:'20dp'
                                                padding:'20dp'
                                                MDLabel:
                                                    text:"Elder's Health Dashboard"
                                                    font_style:"Subtitle2"
                                                MDGridLayout:
                                                    cols:2
                                                    adaptive_height:True
                                                    size_hint_y: None
                                                    height: self.minimum_height 
                                                    spacing:'15dp'
                                                    GridCard:
                                                        source:"assets/icons/padlock.png"
                                                        text:"Approve Accounts"
                                                        on_release: root.approve_accounts_screen()
                                    Screen:
                                        name: "admin_approve_accounts"

                                        ScrollView:
                                            MDBoxLayout:
                                                id: approve_list
                                                orientation: "vertical"
                                                spacing: "10dp"
                                                padding: "20dp"
                                                size_hint_y: None
                                                height: self.minimum_height

                        #MDBottomNavigationItem:
                            #name:"Emergency Screen"
                            #text:"Emergency"
                            #icon:"assets/icons/emergency.png"
                            #MDScreen: #Ecran pentru atunci cand apesi butonul
                                #MDBoxLayout:
                                    #pos_hint:{'center_x':0.5, 'center_y':0.5}
                                    #orientation:'vertical'
                                    #size_hint_y: 0.4
                                    #size_hint_x: 0.4
                                    #spacing: "40dp"
                                    #MDLabel:
                                        #text: "Welcome to the Emergency Screen!"
                                        #halign: "center"
        
        MDNavigationDrawer:
            id: nav_drawer
            radius: [0, 40, 40, 0]
            md_bg_color: 0.95, 0.95, 0.95, 1

            MDBoxLayout:
                orientation: "vertical"
                padding: "20dp"
                spacing: "15dp"

                MDLabel:
                    text: "Menu"
                    theme_text_color: "Custom"
                    text_color: 120/255, 190/255, 220/255
                    font_style: "H6"
                    size_hint_y: None
                    height: self.texture_size[1]
                
                MDSeparator:
                    height: "4dp"

                Widget:
                    size_hint_y: 1
            
                
                MDFlatButton:
                    text: "Home"
                    on_release:
                        app.close_drawer()

                MDSeparator:
                    height: "1dp"
                
                MDFlatButton:
                    text: "Logout"
                    on_release:
                        app.show_logout_dialog()

<DoctorMedItem>:
    size_hint_y: None
    height: dp(100)            # or whichever height makes sense
    orientation: "vertical"
    padding: dp(10)
    spacing: dp(6)

    MDLabel:
        text: "[b]" + root.denumire + "[/b]  -  " + root.forma + " (" + root.concentratie + ")"
        markup: True
        size_hint_y: None
        height: self.texture_size[1]

    MDLabel:
        text: "Frecvență: " + root.frecventa
        size_hint_y: None
        height: self.texture_size[1]

    MDLabel:
        text: "Observații: " + root.observatii
        size_hint_y: None
        height: self.texture_size[1]
    
    MDRaisedButton:
        text: "Șterge"
        size_hint: (None, None)
        size: dp(80), dp(36)
        pos_hint: {"center_x": 0.5}
        on_release:
            # Call MainScreen.delete_medication_dialog, passing the med_id of this item
            app.root.get_screen("main").delete_medication_dialog(root.med_id)

<GridCard@MDCard>:
    ripple_behavior:True
    orientation:'vertical'
    source:''
    radius:25
    folder_size:''
    text:''
    padding:'20dp'
    spacing:'20dp'
    size_hint_y:None
    height:'150dp'
    elevation: 1
    Image:
        source:root.source
    MDBoxLayout:
        orientation:'vertical'
        adaptive_height:True
        MDLabel:
            text:root.text
            adaptive_height:True
            halign:'center'

<MedicationSearchDialog@MDBoxLayout>:
    orientation: "vertical"
    size_hint_y: None
    height: "500dp"
    spacing: "10dp"
    padding: "10dp"

    MDTextField:
        id: search_field
        size_hint_y: None
        height: dp(56)
        hint_text: "Caută medicament"
        on_text: root.filter_medications(self.text)

    RecycleView:
        id: med_rv
        viewclass: "OneLineListItem"
        scroll_type: ['bars', 'content']
        bar_width: "10dp"
        padding: [0, dp(56), 0, 0]
        RecycleBoxLayout:
            orientation: "vertical"
            default_size: None, dp(56)
            default_size_hint: 1, None
            size_hint_y: None
            height: self.minimum_height
            spacing: dp(2)

<DoctorControlForm@MDBoxLayout>:
    orientation: "vertical"
    size_hint_y: None
    height: self.minimum_height
    spacing: dp(8)
    padding: dp(10)

    MDLabel:
        text: "[b]Adaugă Control Medical[/b]"
        markup: True
        size_hint_y: None
        height: dp(32)

    MDTextField:
        id: ctrl_name
        hint_text: "Nume control"
        mode: "rectangle"
        size_hint_y: None
        height: dp(48)

    MDTextField:
        id: ctrl_goal
        hint_text: "Scop"
        mode: "rectangle"
        size_hint_y: None
        height: dp(48)

    MDTextField:
        id: ctrl_details
        hint_text: "Detalii"
        mode: "rectangle"
        multiline: True
        size_hint_y: None
        height: dp(80)

    # We use two separate MDTextFields for date and time inputs; you can
    # replace them with MDDatePicker / MDTimePicker if you want a popup.
    MDTextField:
        id: ctrl_date
        hint_text: "Data (YYYY-MM-DD)"
        mode: "rectangle"
        size_hint_y: None
        height: dp(48)

    MDTextField:
        id: ctrl_time
        hint_text: "Ora (HH:MM)"
        mode: "rectangle"
        size_hint_y: None
        height: dp(48)

    MDRaisedButton:
        text: "Adaugă Control"
        size_hint_y: None
        height: dp(48)
        pos_hint: {"center_x": 0.5}
        on_release:
            app.root.get_screen("main").submit_control(
            root.elder_id,
            root.doctor_id,
            ctrl_name.text.strip(),
            ctrl_goal.text.strip(),
            ctrl_details.text.strip(),
            ctrl_date.text.strip(),
            ctrl_time.text.strip()
            )

<DoctorControlItem>:
    size_hint_y: None
    height: dp(120)
    orientation: "vertical"
    padding: dp(10)
    spacing: dp(6)

    MDLabel:
        text: "[b]" + root.name + "[/b]"
        markup: True
        size_hint_y: None
        height: self.texture_size[1]

    MDLabel:
        text: "Goal: " + root.goal
        size_hint_y: None
        height: self.texture_size[1]

    MDLabel:
        text: "Details: " + root.details
        size_hint_y: None
        height: self.texture_size[1]

    MDLabel:
        text: "When: " + root.scheduled_at
        size_hint_y: None
        height: self.texture_size[1]

    MDRaisedButton:
        text: "Delete"
        size_hint: None, None
        size: dp(80), dp(36)
        pos_hint: {"right": 1}
        on_release:
            app.root.get_screen("main").delete_control(root.control_id)

<ElderControlItem@MDBoxLayout>:
    name: ""
    goal: ""
    details: ""
    scheduled_at: ""    # “YYYY-MM-DD HH:MM:SS”

    orientation: "vertical"
    size_hint_y: None
    height: dp(120)
    padding: dp(8)
    spacing: dp(4)
    md_bg_color: 0.95, 1, 0.95, 1

    MDLabel:
        text: "[b]" + root.name + "[/b]"
        markup: True
        size_hint_y: None
        height: dp(24)

    MDLabel:
        text: "Scop: " + root.goal
        size_hint_y: None
        height: self.texture_size[1]

    MDLabel:
        text: "Detalii: " + root.details
        size_hint_y: None
        height: self.texture_size[1]

    MDLabel:
        text: "Programat la: " + root.scheduled_at
        size_hint_y: None
        height: self.texture_size[1]